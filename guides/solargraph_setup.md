# Setting Up and Optimizing Solargraph

I use and love the the Ruby Solargraph extension for VSCode. It provides code completion, intellisense, and inline documentation.

Whenever I set up for another project, I need to set up Solargraph for it.
Some time in the past I found a [really helpful video by Conner Jensen](https://www.youtube.com/watch?v=mkLDPpDSWng) with step by step instructions to set up and configure Solargraph optimally.
In order to avoid needing to reference the video every time, I write down the instructions for myself.

1. Install the extension from the [VS Marketplace](https://marketplace.visualstudio.com/items?itemName=castwide.solargraph)

2. Install the gem with the command

```
gem install solargraph
```

3. Create a config file in the workspace's root directory named `.solargraph.yml` with the following contents:

```
include:

- "app/**/*.rb"

- "spec/**/*.rb"
```

This optimization speeds up Solargraph by specifying what files to include/exclude in the code maps.

You can adjust your config file to your own project (ex: replacing `spec/**/*.rb` with `test/**/*.rb` when using minitest)

The default config generated by running `solargraph config` has some unnecessary things but can be a fine option if you don't care too much.


4. Generate documentation for your installed gems with the command

```
yard gems
```

5. If you'd like to have yard documentation installed automatically when a new gem is installed, you can run this command

```
yard config --gem-install-yri
```

6. Create the file `config/definitions.rb` and paste in most recent contents of [this gist](https://gist.github.com/castwide/28b349566a223dfb439a337aea29713e) (yes it is all commented out). The contents as of 2023/04/28 are:

```
# The following comments fill some of the gaps in Solargraph's understanding of
# Rails apps. Since they're all in YARD, they get mapped in Solargraph but
# ignored at runtime.
#
# You can put this file anywhere in the project, as long as it gets included in
# the workspace maps. It's recommended that you keep it in a standalone file
# instead of pasting it into an existing one.
#
# @!parse
#   class ActionController::Base
#     include ActionController::MimeResponds
#     extend ActiveSupport::Callbacks::ClassMethods
#     extend AbstractController::Callbacks::ClassMethods
#   end
#   class ActiveRecord::Base
#     extend ActiveRecord::QueryMethods
#     extend ActiveRecord::FinderMethods
#     extend ActiveRecord::Associations::ClassMethods
#     extend ActiveRecord::Inheritance::ClassMethods
#     include ActiveRecord::Persistence
#   end
# @!override ActiveRecord::FinderMethods#find
#   @overload find(id)
#     @param id [Integer]
#     @return [self]
#   @overload find(list)
#     @param list [Array]
#     @return [Array<self>]
#   @overload find(*args)
#     @return [Array<self>]
#   @return [self, Array<self>]
```

  When Rails is initialized, it runs the ruby files in the config directory including this file. The special comments allow Solargraph to discover more method definitions. 

7. Find your Solargraph command path by running the command
```
which solargraph
```
8. Open the Solargraph extension settings in VSCode
9. Copy the result of step 9 into the `Solargraph: Command Path` setting

    This is important if you're using a version manager like rbenv or asdf

10. Make sure the `Solargraph: Use Bundler` setting is unchecked. Otherwise, the custom command path will be ignored.

11. Reload the window with CMD + R (or CTRL + R) and wait for the Solargraph server to reboot.

12. Profit


Much of these instructions can be found on [Solargraph's website](https://solargraph.org), but they aren't presented as succintly. More details and explanations can be found on the site and in the video linked above.